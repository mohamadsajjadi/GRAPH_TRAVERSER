به نام خدا

# الگوهای طراحی شئ‌گرا و بازآرایی کد (Object Oriented Design Patterns and Code Refactoring)

اهداف 
- آشنایی کلی دانشجویان با مفهوم الگو در مهندسی نرم افزار و به طور خاص، الگوهای طراحی شئ‌گرا
- آشنایی دانشجویان با الگوهای طراحی ایجادی به نحوی که در نهایت هم بدانند در چه مواردی می‌توانند از این الگوها استفاده کنند و هم نحوه پیاده‌سازی را فرا گیرند.
- آشنایی با الگوها و ابزارهای بازآرایی کد با هدف افزایش خوانایی و کارایی آن از طریق تغییر در ساختار برنامه بدون اینکه رفتار خارجی آن تغییر کند.

## نیازمندی‌ها
- حداقل یک نفر از اعضای هر گروه باید دارای یک حساب کاربری در github باشد.
- آشنایی اولیه با مفاهیم برنامه نویسی و طراحی شی‌گرا که دانشجویان قبلاً در درس برنامه‌سازی پیشرفته با آن آشنا شده‌اند.
- آزمایش‌های [git](https://github.com/ssc-public/Software-Engineering-Lab/blob/main/courseworks/experiments/git.md) و [SOLID](https://github.com/ssc-public/Software-Engineering-Lab/blob/main/courseworks/experiments/SOLID.md) و [TDD](https://github.com/ssc-public/Software-Engineering-Lab/blob/main/courseworks/experiments/TDD-and-coverage.md)

## ابزارهای مورد استفاده
یک Java IDE مانند IntelliJ IDEA و یا Eclipse به همراه jdk حداقل نسخه ۸

## منابع آموزشی و کوییز
- [توضیحات سایت refactoring.guru](https://refactoring.guru/refactoring)
- [جلسه بیست و چهارم از درس الگوها در مهندسی نرم‌افزار](https://ocw.sharif.edu/course/443/session/id/9738)
- [جلسه سیزدهم از درس الگوها در مهندسی نرم‌افزار](https://ocw.sharif.edu/course/443/session/id/9727)
- [جلسه اول از توضیح الگوهای طراحی درس طراحی شی گرا - دکتر رامسین](https://ocw.sharif.edu/course/385/session/id/8785)
- [جلسه دوم از توضیح الگوهای طراحی درس طراحی شی گرا - دکتر رامسین](https://ocw.sharif.edu/course/385/session/id/8786)
- [جلسه سوم از توضیح الگوهای طراحی درس طراحی شی گرا - دکتر رامسین](https://ocw.sharif.edu/course/385/session/id/8787)

## منابع آزمایش
- [سایت refactoring.guru](https://refactoring.guru)
- [فیلم آموزشی مربوط به بازآرایی](https://aparat.com/v/0r5yH)
- [فیلم آموزشی مربوط به الگو ها](https://aparat.com/v/LZ7WS)
- [پروژه MiniJava و پایه گراف](https://github.com/ssc-public/Software-Engineering-Lab/tree/main/base-projects/Patterns)
- [پروژه پر از بوی بد!](https://github.com/bigsheykh/Convert_UML_to_ANSI_C)
- سایت [getcodeflow.com](https://getcodeflow.com) یا [codeac.io](https://www.codeac.io/)

## منابع مفید
- [جلسه بیست و پنجم از درس الگوها در مهندسی نرم‌افزار](https://ocw.sharif.edu/course/443/session/id/9739)
- [جلسه بیست و ششم از درس الگوها در مهندسی نرم‌افزار](https://ocw.sharif.edu/course/443/session/id/9740)
- [جلسه بیست و هفتم از درس الگوها در مهندسی نرم‌افزار](https://ocw.sharif.edu/course/443/session/id/9741)
- [جلسه بیست و هشتم از درس الگوها در مهندسی نرم‌افزار](https://ocw.sharif.edu/course/443/session/id/9742)
- [سایت sourcemaking.com](https://sourcemaking.com/)


## روال انجام آزمایش

در این آزمایش قرار است در ابتدا یک پیاده سازی با استفاده از الگو های مطرح شده بر روی بخش گراف پروژه MiniJava و پایه گراف داشته باشید.

سپس بخش MiniJava پروژه را بازآرایی کنید.

### فاز اول آزمایش

برای انجام آزمایش، صورت مسئله فرضی زیر را در نظر بگیرید و سعی کنید با بهره گیری از الگوهای طراحی Strategy و State آن را پیاده سازی کنید:

هدف ما، ساخت یک سیستم اطلاع رسانی به شهروندان برای اعلام میزان فاصله و هزینه میان شهر ها است.

ما یک سیستم استانی داریم که شهر ها این ویژگی را دارا هستند.
1. بعضی از آن ها به هم راه دارند و یال مانند به هم وصل هستند.
2. استاندار می تواند این مسیر ها را یکطرفه کند و یا دو طرفه نگه دارد.
3. دو شهری که به هم وصل هستند ۲ روش تردد دارند.

در روش اول قطار سریع السیر را داریم که دقیقا یک واحد زمانی یکسانی را طی کنند که در ابتدا این عدد ۱ می باشد.

در روش دوم اتوبوس ها را داریم که زمان مشخصی دارند که می تواند ۱ واحد زمانی نباشد.


#### اجرای برنامه
 
در اجرای برنامه در ابتدا، گراف شهری دریافت می‌شود.
سپس در یک حلقه تا زمانی که درخواست خروج داده نشده است درخواست های متفاوتی دریافت می شود.
استاندار می تواند ۳ نوع درخواست بدهد:
1. یک درخواست یک طرفه کردن همه مسیر ها است.
2. یک درخواست دو طرفه کردن همه مسیر ها است.
3. واحد زمانی حرکت قطار ها را تغییر بدهد.

شهروندان می توانند ۴ نوع درخواست بدهند:
1. فاصله زمانی از شهر الف به شهر ب با استفاده از قطار چقدر است.
2. فاصله زمانی از شهر الف به شهر ب با استفاده از اتوبوس چقدر است.
3. فاصله زمانی از شهر الف به ب با چه وسیله ای سریع تر است.
4. بعضی از افراد از یکسری شهر ها خوششان نمیاد. به آن ها بگویید که آیا از شهر الف به شهر ب بدون رفتن به شهر مذکور ممکن است یا خیر. 
راهنمایی: برای پیدا کردن جواب متغییر visit شهر مورد نفرت را True قرار دهید.

#### ملاحظات
- ارائه گزارش از مراحل پیاده‌سازی الگوهای فوق در فایل README پروژه. لازم است تحقق هر کدام از دو الگوی خواسته شده را به صورت دقیق توضیح دهید.
- بایستی از رویکرد ایجاد آزمون‌رانه (TDD) استفاده کنید.
- حق تغییر کد های نوشته شده را دارید و مانند پیاده سازی های جدید باید با توجه به رویکرد آزمون‌رانه حتما عمل کنید.
- در بخش گراف پروژه برای شما الگوریتم های bfs و دایکسترا پیاده سازی شده است که می توانید به ترتیب برای محاسبه فاصله با استفاده از قطار و با استفاده از اتوبوس استفاده کنید.

### فاز دوم آزمایش
در این فاز آزمایش قرار است هفت مورد بازآرایی بر روی بخش MiniJava این پروژه انجام دهید:
- دو مورد اعمال الگوی [Facade](https://refactoring.guru/design-patterns/facade)
- یک مورد [State/Strategy](https://refactoring.guru/replace-type-code-with-state-strategy) یا [استفاده از Polymorphism به جای شرط](https://refactoring.guru/replace-conditional-with-polymorphism) 
- یک مورد [Separate Query From Modifier](https://refactoring.guru/separate-query-from-modifier)
- یک مورد [Self Encapsulated Field](https://refactoring.guru/self-encapsulate-field).
- دو مورد مختلف غیر از بازآرایی‌های مطرح‌شده در موارد بالا.
    - در [اینجا](https://refactoring.guru/refactoring/techniques) می‌توانید لیستی از تمام بازآرایی‌های موجود را ببینید.
    - بازآرایی‌های خیلی ساده مانند تغییر نام متغیرها، تغییر نوع خصیصه‌های یک کلاس (برای مثال از private به final) یا پاک‌کردن کدهای کامنت‌شده، حساب نیست.
 - بعد از بازآرایی، پلاگین [formatter](https://code.revelc.net/formatter-maven-plugin/) را به فایل maven اضافه کنید.

به ازای هر بازآرایی، یک commit کنید و نام آن بازآرایی را هم بیاورید.

در این گزارش هر کدام از بازآرایی‌های انجام شده را در حد دو خط توضیح دهید.

## پرسش‌ها
علاوه بر گزارش آزمایش، پاسخ سوالات زیر را هم داخل فایل report.md بنویسید:

1. در کتاب GoF سه دسته الگوی طراحی معرفی شده است. آن‌ها را نام ببرید و در مورد هر دسته در حد دو خط توضیح دهید.
2. الگوهای استفاده شده در فاز اول آزمایش جزو کدام دسته هستند؟
3. با توجه به این که در فاز اول در هر زمان درخواست دقیقا در یکی از دو حالت یک طرفه و یا دو طرفه هستیم کدام الگوی طراحی را برای پاسخ دادن به سوال کاربران مناسب می‌دانید؟ ضمن بیان علت انتخاب خود، نحوه تحقق الگو را به طور کامل توضیح دهید.
4. تحقق و یا عدم تحقق هر کدام از اصول SOLID را در خصوص الگوی طراحی Singleton بیان کنید (هرکدام حداکثر در سه خط).
5. هر یک از مفاهیم زیر را در حد یک خط توضیح دهید.
    - کد تمیز
    - بدهی فنی
    - بوی بد
6. طبق دسته‌بندی وب‌سایت [refactoring.guru](https://refactoring.guru/refactoring/smells)، بوهای بد کد به پنج دسته تقسیم می‌شوند. در مورد هر کدام از این پنج دسته توضیح مختصری دهید.
7. یکی از انواع بوهای بد، Lazy Class است.
    - این بوی بد در کدام یک از دسته‌بندی‌های پنج‌گانه قرار می‌گیرد؟
    - برای برطرف‌کردن این بو، استفاده از کدام بازآرایی‌ها پیشنهاد می‌شود؟
    - در چه مواقعی باید این بو را نادیده گرفت؟
8. در وبسایت 29 بوی بد کد نامبرده شده است. سعی کنید 10 بوی بد را در [پروژه تبدیل کننده مدل به سی](https://github.com/bigsheykh/Convert_UML_to_ANSI_C) پیدا کنید و به آن اشاره کنید.
9. در انتها بگویید پلاگین [formatter](https://code.revelc.net/formatter-maven-plugin/) چه می کند و چرا می تواند کمک کننده باشد و رابطه آن با باز آرایی کد چیست؟
   

## نحوه ارسال آزمایش
آدرس مخزن پروژه خود را ارسال کنید. توجه کنید که مخزن شما عمومی (public) باشد.
